/*
 * @file livedata/Store.ts
 * Relution SDK
 *
 * Created by Thomas Beckmann on 24.06.2015
 * Copyright 2016 M-Way Solutions GmbH
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @module livedata
 */
/** */
"use strict";
var Backbone = require('backbone');
var _ = require('lodash');
var Q = require('q');
var diag = require('../core/diag');
/**
 * tests whether a given object is a Store.
 *
 * @param {object} object to check.
 * @return {boolean} whether object is a Store.
 */
function isStore(object) {
    if (!object || typeof object !== 'object') {
        return false;
    }
    else if ('isStore' in object) {
        diag.debug.assert(function () { return object.isStore === Store.prototype.isPrototypeOf(object); });
        return object.isStore;
    }
    else {
        return Store.prototype.isPrototypeOf(object);
    }
}
exports.isStore = isStore;
/**
 * base class to build a custom data store.
 */
var Store = (function () {
    function Store(options) {
        if (options) {
            // copy options values into the object
            _.extend(this, options);
        }
    }
    Store.prototype.close = function () {
        // nothing to do
    };
    Store.prototype.initModel = function (model, options) {
        // may be overwritten
    };
    Store.prototype.initCollection = function (collection, options) {
        // may be overwritten
    };
    Store.prototype.sync = function (method, model, options) {
        // must be overwritten
        return Q.reject(new Error('not implemented!')); // purely abstract
    };
    /**
     *
     * @param collection usually a collection, but can also be a model
     * @param options
     */
    Store.prototype.fetch = function (collection, options) {
        var opts = _.extend({}, options || {}, { store: this });
        return collection.fetch(opts);
    };
    Store.prototype.create = function (collection, models, options) {
        var opts = _.extend({}, options || {}, { store: this });
        return new collection(models, opts);
    };
    Store.prototype.save = function (model, attributes, options) {
        var opts = _.extend({}, options || {}, { store: this });
        return model.save(attributes, opts);
    };
    Store.prototype.destroy = function (model, options) {
        var opts = _.extend({}, options || {}, { store: this });
        model.destroy(opts);
    };
    Store.prototype.handleSuccess = function (options, result) {
        if (options.success) {
            return options.success.call(this, result);
        }
    };
    Store.prototype.handleError = function (options, error) {
        if (options.error) {
            return options.error.call(this, error);
        }
    };
    return Store;
}());
exports.Store = Store;
// mixins
var store = _.extend(Store.prototype, Backbone.Events, {
    _type: 'Relution.livedata.Store',
    isModel: false,
    isCollection: false,
    isStore: true,
    name: 'relution-livedata'
});
diag.debug.assert(function () { return Store.prototype.isPrototypeOf(Object.create(store)); });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RvcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbGl2ZWRhdGEvU3RvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQWtCRztBQUNIOztHQUVHO0FBQ0gsTUFBTTs7QUFFTixJQUFZLFFBQVEsV0FBTSxVQUFVLENBQUMsQ0FBQTtBQUNyQyxJQUFZLENBQUMsV0FBTSxRQUFRLENBQUMsQ0FBQTtBQUM1QixJQUFZLENBQUMsV0FBTSxHQUFHLENBQUMsQ0FBQTtBQUN2QixJQUFZLElBQUksV0FBTSxjQUFjLENBQUMsQ0FBQTtBQWdCckM7Ozs7O0dBS0c7QUFDSCxpQkFBd0IsTUFBVztJQUNqQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDZixDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQy9CLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLGNBQU0sT0FBQSxNQUFNLENBQUMsT0FBTyxLQUFLLEtBQUssQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUF4RCxDQUF3RCxDQUFDLENBQUM7UUFDbEYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUM7SUFDeEIsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQy9DLENBQUM7QUFDSCxDQUFDO0FBVGUsZUFBTyxVQVN0QixDQUFBO0FBRUQ7O0dBRUc7QUFDSDtJQWFFLGVBQVksT0FBYTtRQUN2QixFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ1osc0NBQXNDO1lBQ3RDLENBQUMsQ0FB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S0FBSztJQUNuQixPQUFPLEVBQUUsSUFBSTtJQUViLElBQUksRUFBRSxtQkFBbUI7Q0FDMUIsQ0FBQyxDQUFDO0FBQ0gsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsY0FBTSxPQUFBLEtBQUssQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBbkQsQ0FBbUQsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQGZpbGUgbGl2ZWRhdGEvU3RvcmUudHNcclxuICogUmVsdXRpb24gU0RLXHJcbiAqXHJcbiAqIENyZWF0ZWQgYnkgVGhvbWFzIEJlY2ttYW5uIG9uIDI0LjA2LjIwMTVcclxuICogQ29weXJpZ2h0IDIwMTYgTS1XYXkgU29sdXRpb25zIEdtYkhcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBAbW9kdWxlIGxpdmVkYXRhXHJcbiAqL1xyXG4vKiogKi9cclxuXHJcbmltcG9ydCAqIGFzIEJhY2tib25lIGZyb20gJ2JhY2tib25lJztcclxuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xyXG5pbXBvcnQgKiBhcyBRIGZyb20gJ3EnO1xyXG5pbXBvcnQgKiBhcyBkaWFnIGZyb20gJy4uL2NvcmUvZGlhZyc7XHJcblxyXG5pbXBvcnQge01vZGVsfSBmcm9tICcuL01vZGVsJztcclxuaW1wb3J0IHtDb2xsZWN0aW9ufSBmcm9tICcuL0NvbGxlY3Rpb24nO1xyXG5pbXBvcnQge0NvbGxlY3Rpb25DdG9yfSBmcm9tIFwiLi9Db2xsZWN0aW9uXCI7XHJcblxyXG4vKipcclxuICogY29uc3RydWN0b3IgZnVuY3Rpb24gb2YgU3RvcmUuXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFN0b3JlQ3RvciB7XHJcbiAgLyoqXHJcbiAgICogQHNlZSBTdG9yZSNjb25zdHJ1Y3RvclxyXG4gICAqL1xyXG4gIG5ldyhvcHRpb25zPzogYW55KTogU3RvcmU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiB0ZXN0cyB3aGV0aGVyIGEgZ2l2ZW4gb2JqZWN0IGlzIGEgU3RvcmUuXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBvYmplY3QgdG8gY2hlY2suXHJcbiAqIEByZXR1cm4ge2Jvb2xlYW59IHdoZXRoZXIgb2JqZWN0IGlzIGEgU3RvcmUuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaXNTdG9yZShvYmplY3Q6IGFueSk6IG9iamVjdCBpcyBTdG9yZSB7XHJcbiAgaWYgKCFvYmplY3QgfHwgdHlwZW9mIG9iamVjdCAhPT0gJ29iamVjdCcpIHtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9IGVsc2UgaWYgKCdpc1N0b3JlJyBpbiBvYmplY3QpIHtcclxuICAgIGRpYWcuZGVidWcuYXNzZXJ0KCgpID0+IG9iamVjdC5pc1N0b3JlID09PSBTdG9yZS5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihvYmplY3QpKTtcclxuICAgIHJldHVybiBvYmplY3QuaXNTdG9yZTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIFN0b3JlLnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKG9iamVjdCk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogYmFzZSBjbGFzcyB0byBidWlsZCBhIGN1c3RvbSBkYXRhIHN0b3JlLlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFN0b3JlIHtcclxuXHJcbiAgcHVibGljIF90eXBlOiBzdHJpbmc7ICAgICAgICAgLy8gY29uc3RhbnQgJ1JlbHV0aW9uLmxpdmVkYXRhLlN0b3JlJyBvbiBwcm90b3R5cGVcclxuICBwdWJsaWMgaXNNb2RlbDogYm9vbGVhbjsgICAgICAvLyBjb25zdGFudCBmYWxzZSBvbiBwcm90b3R5cGVcclxuICBwdWJsaWMgaXNDb2xsZWN0aW9uOiBib29sZWFuOyAvLyBjb25zdGFudCBmYWxzZSBvbiBwcm90b3R5cGVcclxuICBwdWJsaWMgaXNTdG9yZTogYm9vbGVhbjsgICAgICAvLyBjb25zdGFudCB0cnVlIG9uIHByb3RvdHlwZVxyXG5cclxuICAvLyBmb2xsb3dpbmcgYXJlIHN0b3JlLXNwZWNpZmljIG9wdGlvbnMsIGRlZmF1bHRzIHN0b3JlZCBpbiBwcm90b3R5cGUgYXQgZW5kIG9mIHRoaXMgZmlsZVxyXG4gIHByb3RlY3RlZCBuYW1lOiBzdHJpbmc7XHJcblxyXG4gIHByb3RlY3RlZCBlbnRpdGllczogYW55O1xyXG4gIHB1YmxpYyBlbmRwb2ludHM6IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3Iob3B0aW9ucz86IGFueSkge1xyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgLy8gY29weSBvcHRpb25zIHZhbHVlcyBpbnRvIHRoZSBvYmplY3RcclxuICAgICAgXy5leHRlbmQodGhpcywgb3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY2xvc2UoKSB7XHJcbiAgICAvLyBub3RoaW5nIHRvIGRvXHJcbiAgfVxyXG5cclxuICBpbml0TW9kZWwobW9kZWw6IE1vZGVsLCBvcHRpb25zPzogYW55KTogdm9pZCB7XHJcbiAgICAvLyBtYXkgYmUgb3ZlcndyaXR0ZW5cclxuICB9XHJcblxyXG4gIGluaXRDb2xsZWN0aW9uKGNvbGxlY3Rpb246IENvbGxlY3Rpb24sIG9wdGlvbnM/OiBhbnkpOiB2b2lkIHtcclxuICAgIC8vIG1heSBiZSBvdmVyd3JpdHRlblxyXG4gIH1cclxuXHJcbiAgc3luYyhtZXRob2Q6IHN0cmluZywgbW9kZWw6IE1vZGVsIHwgQ29sbGVjdGlvbiwgb3B0aW9ucz86IGFueSk6IFEuUHJvbWlzZTxhbnk+IHtcclxuICAgIC8vIG11c3QgYmUgb3ZlcndyaXR0ZW5cclxuICAgIHJldHVybiBRLnJlamVjdChuZXcgRXJyb3IoJ25vdCBpbXBsZW1lbnRlZCEnKSk7IC8vIHB1cmVseSBhYnN0cmFjdFxyXG4gIH1cclxuXHJcbiAgZmV0Y2goY29sbGVjdGlvbjogTW9kZWwsIG9wdGlvbnM6IEJhY2tib25lLk1vZGVsRmV0Y2hPcHRpb25zKTogUS5Qcm9taXNlPGFueT47XHJcbiAgZmV0Y2goY29sbGVjdGlvbjogQ29sbGVjdGlvbiwgb3B0aW9uczogQmFja2JvbmUuQ29sbGVjdGlvbkZldGNoT3B0aW9ucyk6IFEuUHJvbWlzZTxhbnk+O1xyXG4gIC8qKlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGNvbGxlY3Rpb24gdXN1YWxseSBhIGNvbGxlY3Rpb24sIGJ1dCBjYW4gYWxzbyBiZSBhIG1vZGVsXHJcbiAgICogQHBhcmFtIG9wdGlvbnNcclxuICAgKi9cclxuICBmZXRjaChjb2xsZWN0aW9uOiBNb2RlbCB8IENvbGxlY3Rpb24sIG9wdGlvbnM6IEJhY2tib25lLk1vZGVsRmV0Y2hPcHRpb25zIHwgQmFja2JvbmUuQ29sbGVjdGlvbkZldGNoT3B0aW9ucykge1xyXG4gICAgdmFyIG9wdHMgPSBfLmV4dGVuZCh7fSwgb3B0aW9ucyB8fCB7fSwgeyBzdG9yZTogdGhpcyB9KTtcclxuICAgIHJldHVybiAoPGFueT5jb2xsZWN0aW9uKS5mZXRjaChvcHRzKTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZShjb2xsZWN0aW9uOiBDb2xsZWN0aW9uQ3RvciwgbW9kZWxzOiBNb2RlbFtdLCBvcHRpb25zPzogYW55KSB7XHJcbiAgICB2YXIgb3B0cyA9IF8uZXh0ZW5kKHt9LCBvcHRpb25zIHx8IHt9LCB7IHN0b3JlOiB0aGlzIH0pO1xyXG4gICAgcmV0dXJuIG5ldyBjb2xsZWN0aW9uKG1vZGVscywgb3B0cyk7XHJcbiAgfVxyXG5cclxuICBzYXZlKG1vZGVsOiBNb2RlbCwgYXR0cmlidXRlcz86IGFueSwgb3B0aW9ucz86IEJhY2tib25lLk1vZGVsU2F2ZU9wdGlvbnMpIHtcclxuICAgIHZhciBvcHRzID0gXy5leHRlbmQoe30sIG9wdGlvbnMgfHwge30sIHsgc3RvcmU6IHRoaXMgfSk7XHJcbiAgICByZXR1cm4gbW9kZWwuc2F2ZShhdHRyaWJ1dGVzLCBvcHRzKTtcclxuICB9XHJcblxyXG4gIGRlc3Ryb3kobW9kZWw6IE1vZGVsLCBvcHRpb25zPzogQmFja2JvbmUuTW9kZWxEZXN0cm95T3B0aW9ucykge1xyXG4gICAgdmFyIG9wdHMgPSBfLmV4dGVuZCh7fSwgb3B0aW9ucyB8fCB7fSwgeyBzdG9yZTogdGhpcyB9KTtcclxuICAgIG1vZGVsLmRlc3Ryb3kob3B0cyk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgdHJpZ2dlcjogdHlwZW9mIEJhY2tib25lLkV2ZW50cy5wcm90b3R5cGUudHJpZ2dlcjtcclxuXHJcbiAgcHJvdGVjdGVkIGhhbmRsZVN1Y2Nlc3Mob3B0aW9uczoge1xyXG4gICAgc3VjY2Vzcz86IEZ1bmN0aW9uXHJcbiAgfSwgcmVzdWx0OiBhbnkpOiBhbnkge1xyXG4gICAgaWYgKG9wdGlvbnMuc3VjY2Vzcykge1xyXG4gICAgICByZXR1cm4gb3B0aW9ucy5zdWNjZXNzLmNhbGwodGhpcywgcmVzdWx0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBoYW5kbGVFcnJvcihvcHRpb25zOiB7XHJcbiAgICBlcnJvcj86IEZ1bmN0aW9uXHJcbiAgfSwgZXJyb3I6IEVycm9yKTogYW55IHtcclxuICAgIGlmIChvcHRpb25zLmVycm9yKSB7XHJcbiAgICAgIHJldHVybiBvcHRpb25zLmVycm9yLmNhbGwodGhpcywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLy8gbWl4aW5zXHJcbmxldCBzdG9yZSA9IF8uZXh0ZW5kKFN0b3JlLnByb3RvdHlwZSwgQmFja2JvbmUuRXZlbnRzLCB7XHJcbiAgX3R5cGU6ICdSZWx1dGlvbi5saXZlZGF0YS5TdG9yZScsXHJcbiAgaXNNb2RlbDogZmFsc2UsXHJcbiAgaXNDb2xsZWN0aW9uOiBmYWxzZSxcclxuICBpc1N0b3JlOiB0cnVlLFxyXG5cclxuICBuYW1lOiAncmVsdXRpb24tbGl2ZWRhdGEnXHJcbn0pO1xyXG5kaWFnLmRlYnVnLmFzc2VydCgoKSA9PiBTdG9yZS5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihPYmplY3QuY3JlYXRlKHN0b3JlKSkpO1xyXG4iXX0=